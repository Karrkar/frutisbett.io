<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ°Ñ ÑĞ»Ğ¾Ñ‚-Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ° 5x3</title>
<style>
  /* --- ĞĞ±Ñ‰Ğ¸Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸ --- */
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #1a1a1a, #444);
    color: #fff;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }
  h1 {
    margin-bottom: 10px;
    text-align: center;
  }
  .info-bar {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin-bottom: 15px;
  }
  .info-bar > div {
    font-size: 18px;
  }
  .progress-bar {
    width: 300px;
    height: 20px;
    background: #555;
    border-radius: 10px;
    overflow: hidden;
    margin: 10px 0 20px;
  }
  .progress-fill {
    height: 100%;
    background: #4caf50;
    width: 0%;
    transition: width 0.5s ease;
  }
  .slot-machine {
    display: grid;
    grid-template-columns: repeat(5, 80px);
    grid-template-rows: repeat(3, 80px);
    gap: 10px;
    background: #222;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 20px #0f0;
    user-select: none;
  }
  .slot {
    background: #000;
    border-radius: 10px;
    font-size: 48px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: inset 0 0 10px #0f0;
    transition: background-color 0.3s, transform 0.3s;
    position: relative;
  }
  .slot.win {
    background-color: gold;
    color: black;
    box-shadow: 0 0 15px 5px gold;
    animation: winPulse 1s infinite alternate;
  }
  @keyframes winPulse {
    0% { transform: scale(1); }
    100% { transform: scale(1.1); }
  }
  button {
    margin-top: 15px;
    padding: 12px 25px;
    font-size: 18px;
    cursor: pointer;
    border-radius: 12px;
    border: none;
    background: #4caf50;
    color: white;
    box-shadow: 0 5px #388e3c;
    transition: background 0.3s;
  }
  button:active {
    box-shadow: 0 2px #388e3c;
    transform: translateY(3px);
  }
  .controls {
    margin-top: 15px;
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
  }
  .message {
    margin-top: 20px;
    font-size: 18px;
    min-height: 80px;
    white-space: pre-line;
    color: #ff0;
    max-width: 420px;
    text-align: center;
  }
  .history, .leaderboard {
    margin-top: 20px;
    max-height: 120px;
    overflow-y: auto;
    width: 420px;
    background: #111;
    border-radius: 10px;
    padding: 10px;
    font-size: 14px;
    color: #ccc;
  }
  .leaderboard h3 {
    margin: 0 0 10px 0;
    text-align: center;
  }
  /* ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ */
  @media (max-width: 480px) {
    .slot-machine {
      grid-template-columns: repeat(5, 50px);
      grid-template-rows: repeat(3, 50px);
      gap: 6px;
      padding: 10px;
    }
    .slot {
      font-size: 32px;
    }
    .progress-bar {
      width: 90vw;
    }
    .history, .leaderboard {
      width: 90vw;
    }
  }
</style>
</head>
<body>

<h1>Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ°Ñ ÑĞ»Ğ¾Ñ‚-Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ° 5x3</h1>

<div class="info-bar">
  <div>Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ: <span id="balanceDisplay">100 â‚½</span></div>
  <div>Ğ¡Ñ‚Ğ°Ğ²ĞºĞ°: <button id="betMinus">-</button> <span id="betAmount">1</span> â‚½ <button id="betPlus">+</button></div>
  <div>Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ: <span id="levelDisplay">1</span></div>
  <div>Ğ¤Ñ€Ğ¸ÑĞ¿Ğ¸Ğ½Ñ‹: <span id="freeSpinsDisplay">0</span></div>
  <div>Ğ”Ğ¶ĞµĞºĞ¿Ğ¾Ñ‚: <span id="jackpotDisplay">500 â‚½</span></div>
  <div>ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ: <span id="lastWinDisplay">0 â‚½</span></div>
</div>

<div class="progress-bar" title="ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ´Ğ¾ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ">
  <div class="progress-fill" id="xpBar"></div>
</div>

<div class="slot-machine" id="slotMachine"></div>

<div class="controls">
  <button id="spinButton">Ğ’Ñ€Ğ°Ñ‰Ğ°Ñ‚ÑŒ ğŸ°</button>
  <button id="fastSpinButton">Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑĞ¿Ğ¸Ğ½ âš¡</button>
  <button id="toggleMusicButton">ĞœÑƒĞ·Ñ‹ĞºĞ°: Ğ’ĞºĞ»</button>
</div>

<div class="message" id="message"></div>

<div class="history" id="history" title="Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞ¿Ğ¸Ğ½Ğ¾Ğ²"></div>

<div class="leaderboard">
  <h3>Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ² (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾)</h3>
  <div id="leaderboardList"></div>
</div>

<!-- Ğ—Ğ²ÑƒĞºĞ¸ -->
<audio id="soundSpin" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>
<audio id="soundWin" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
<audio id="soundBonus" src="https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg" preload="auto"></audio>
<audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2022/03/27/audio_7e5c1c4e5a.mp3?filename=retro-game-loop-11214.mp3" loop preload="auto"></audio>

<script>
(() => {
  // --- ĞšĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹ Ğ¸ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ ---
  const slotMachine = document.getElementById('slotMachine');
  const spinButton = document.getElementById('spinButton');
  const fastSpinButton = document.getElementById('fastSpinButton');
  const balanceDisplay = document.getElementById('balanceDisplay');
  const message = document.getElementById('message');
  const historyDiv = document.getElementById('history');
  const betMinus = document.getElementById('betMinus');
  const betPlus = document.getElementById('betPlus');
  const betAmountSpan = document.getElementById('betAmount');
  const levelDisplay = document.getElementById('levelDisplay');
  const xpBar = document.getElementById('xpBar');
  const jackpotDisplay = document.getElementById('jackpotDisplay');
  const lastWinDisplay = document.getElementById('lastWinDisplay');
  const freeSpinsDisplay = document.getElementById('freeSpinsDisplay');
  const toggleMusicButton = document.getElementById('toggleMusicButton');
  const leaderboardList = document.getElementById('leaderboardList');

  const soundSpin = document.getElementById('soundSpin');
  const soundWin = document.getElementById('soundWin');
  const soundBonus = document.getElementById('soundBonus');
  const bgMusic = document.getElementById('bgMusic');

  const columns = 5;
  const rows = 3;
  const totalSlots = columns * rows;

  // Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² Ğ½Ğ° Ğ±Ğ°Ñ€Ğ°Ğ±Ğ°Ğ½Ğ°Ñ… (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ±Ğ°Ñ€Ğ°Ğ±Ğ°Ğ½ - Ğ¼Ğ°ÑÑĞ¸Ğ² ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)
  // Ğ¡Ğ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ñ Ñ€Ğ°Ğ·Ğ½Ğ¾Ğ¹ Ñ‡Ğ°ÑÑ‚Ğ¾Ñ‚Ğ¾Ğ¹, Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ñ€ĞµĞ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ RTP
  const reels = [
    ["ğŸ’","ğŸ‹","ğŸŠ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ","ğŸ¥","ğŸŒ","ğŸ¥¥","ğŸ","â­","ğŸ’","ğŸƒ","ğŸ’","ğŸ‹","ğŸŠ","ğŸ‰","ğŸ‡","ğŸ“"],
    ["ğŸ‹","ğŸŠ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ","ğŸ¥","ğŸŒ","ğŸ¥¥","ğŸ","â­","ğŸ’","ğŸƒ","ğŸ’","ğŸ‹","ğŸŠ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ"],
    ["ğŸŠ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ","ğŸ¥","ğŸŒ","ğŸ¥¥","ğŸ","â­","ğŸ’","ğŸƒ","ğŸ’","ğŸ‹","ğŸŠ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ","ğŸ¥"],
    ["ğŸ‰","ğŸ‡","ğŸ“","ğŸ","ğŸ¥","ğŸŒ","ğŸ¥¥","ğŸ","â­","ğŸ’","ğŸƒ","ğŸ’","ğŸ‹","ğŸŠ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ","ğŸ¥","ğŸŒ"],
    ["ğŸ‡","ğŸ“","ğŸ","ğŸ¥","ğŸŒ","ğŸ¥¥","ğŸ","â­","ğŸ’","ğŸƒ","ğŸ’","ğŸ‹","ğŸŠ","ğŸ‰","ğŸ‡","ğŸ“","ğŸ","ğŸ¥","ğŸŒ","ğŸ¥¥"]
  ];

  // Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ²Ñ‹Ğ¿Ğ»Ğ°Ñ‚ (Ğ´Ğ»Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ñ… ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)
  const payTable = {
    "ğŸ’": {3:5, 4:10, 5:20},
    "ğŸ‹": {3:5, 4:10, 5:20},
    "ğŸŠ": {3:5, 4:10, 5:20},
    "ğŸ‰": {3:5, 4:10, 5:20},
    "ğŸ‡": {3:5, 4:10, 5:20},
    "ğŸ“": {3:7, 4:14, 5:28},
    "ğŸ": {3:7, 4:14, 5:28},
    "ğŸ¥": {3:7, 4:14, 5:28},
    "ğŸŒ": {3:7, 4:14, 5:28},
    "ğŸ¥¥": {3:7, 4:14, 5:28}
  };

  // Ğ›Ğ¸Ğ½Ğ¸Ğ¸ Ğ²Ñ‹Ğ¿Ğ»Ğ°Ñ‚ (6 Ğ»Ğ¸Ğ½Ğ¸Ğ¹)
  const winLines = [
    [0,1,2,3,4],       // Ğ²ĞµÑ€Ñ…Ğ½Ğ¸Ğ¹ Ñ€ÑĞ´
    [5,6,7,8,9],       // ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€ÑĞ´
    [10,11,12,13,14],  // Ğ½Ğ¸Ğ¶Ğ½Ğ¸Ğ¹ Ñ€ÑĞ´
    [0,6,12,8,14],     // Ğ´Ğ¸Ğ°Ğ³Ğ¾Ğ½Ğ°Ğ»ÑŒ ÑĞ²ĞµÑ€Ñ…Ñƒ ÑĞ»ĞµĞ²Ğ° Ğ²Ğ½Ğ¸Ğ· ÑĞ¿Ñ€Ğ°Ğ²Ğ°
    [10,6,2,8,4],      // Ğ´Ğ¸Ğ°Ğ³Ğ¾Ğ½Ğ°Ğ»ÑŒ ÑĞ½Ğ¸Ğ·Ñƒ ÑĞ»ĞµĞ²Ğ° Ğ²Ğ²ĞµÑ€Ñ… ÑĞ¿Ñ€Ğ°Ğ²Ğ°
    [5,1,7,3,9]        // Ğ·Ğ¸Ğ³Ğ·Ğ°Ğ³ Ğ¿Ğ¾ ÑĞµÑ€ĞµĞ´Ğ¸Ğ½Ğµ
  ];

  // ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¸Ğ³Ñ€Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ
  let balance = 100;
  let freeSpins = 0;
  let betAmount = 1;
  let level = 1;
  let xp = 0;
  const xpPerLevel = 100;
  let jackpot = 500;
  let lastWin = 0;

  // Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ ÑĞ¿Ğ¸Ğ½Ğ¾Ğ²
  let spinHistory = [];

  // Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ±Ğ°Ñ€Ğ°Ğ±Ğ°Ğ½Ğ¾Ğ² (Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ±Ğ°Ñ€Ğ°Ğ±Ğ°Ğ½Ğ°)
  let reelPositions = [0,0,0,0,0];

  // Ğ¤Ğ»Ğ°Ğ³ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¹ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸
  let fastSpin = false;

  // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ÑĞ»Ğ¾Ñ‚Ñ‹
  function createSlots(){
    slotMachine.innerHTML = '';
    for(let i=0; i<totalSlots; i++){
      const slot = document.createElement('div');
      slot.classList.add('slot');
      slot.textContent = "â“";
      slotMachine.appendChild(slot);
    }
  }

  // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°
  function saveProgress(){
    localStorage.setItem('slotBalance', balance);
    localStorage.setItem('slotFreeSpins', freeSpins);
    localStorage.setItem('slotBet', betAmount);
    localStorage.setItem('slotLevel', level);
    localStorage.setItem('slotXP', xp);
    localStorage.setItem('slotJackpot', jackpot);
    localStorage.setItem('slotHistory', JSON.stringify(spinHistory));
    localStorage.setItem('slotLastWin', lastWin);
  }
  function loadProgress(){
    const b = localStorage.getItem('slotBalance');
    if(b!==null) balance = +b;
    const fs = localStorage.getItem('slotFreeSpins');
    if(fs!==null) freeSpins = +fs;
    const bet = localStorage.getItem('slotBet');
    if(bet!==null) betAmount = +bet;
    const lvl = localStorage.getItem('slotLevel');
    if(lvl!==null) level = +lvl;
    const xpVal = localStorage.getItem('slotXP');
    if(xpVal!==null) xp = +xpVal;
    const jp = localStorage.getItem('slotJackpot');
    if(jp!==null) jackpot = +jp;
    const hist = localStorage.getItem('slotHistory');
    if(hist) spinHistory = JSON.parse(hist);
    const lw = localStorage.getItem('slotLastWin');
    if(lw!==null) lastWin = +lw;
  }

  // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°
  function updateUI(){
    balanceDisplay.textContent = `${balance.toFixed(2)} â‚½`;
    betAmountSpan.textContent = betAmount;
    levelDisplay.textContent = level;
    jackpotDisplay.textContent = `${jackpot.toFixed(2)} â‚½`;
    lastWinDisplay.textContent = `${lastWin.toFixed(2)} â‚½`;
    freeSpinsDisplay.textContent = freeSpins;

    let progressPercent = Math.min(100, (xp / xpPerLevel) * 100);
    xpBar.style.width = progressPercent + '%';

    historyDiv.innerHTML = spinHistory.slice(-10).reverse().map(h => {
      return `${h.time} - Ğ¡Ñ‚Ğ°Ğ²ĞºĞ°: ${h.bet} â‚½, Ğ’Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ: ${h.win} â‚½`;
    }).join('<br>');

    updateLeaderboard();
    saveProgress();
  }

  // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ² (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾)
  function updateLeaderboard(){
    let leaderboard = JSON.parse(localStorage.getItem('slotLeaderboard')) || [];
    leaderboardList.innerHTML = leaderboard.length === 0 ? 'ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…' :
      leaderboard.map((entry, i) => `<div>${i+1}. ${entry.name}: ${entry.score} â‚½</div>`).join('');
  }

  // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ²
  function addToLeaderboard(name, score){
    let leaderboard = JSON.parse(localStorage.getItem('slotLeaderboard')) || [];
    leaderboard.push({name, score});
    leaderboard.sort((a,b) => b.score - a.score);
    if(leaderboard.length > 10) leaderboard = leaderboard.slice(0,10);
    localStorage.setItem('slotLeaderboard', JSON.stringify(leaderboard));
    updateLeaderboard();
  }

  // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¾Ğ¿Ñ‹Ñ‚Ğ° Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹
  function addXP(amount){
    xp += amount;
    while(xp >= xpPerLevel){
      xp -= xpPerLevel;
      level++;
      message.textContent += `\nğŸ‰ ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼! Ğ’Ñ‹ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ»Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ ${level}!`;
      balance += level * 5;
      soundBonus.play();
    }
  }

  // Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ° Ñ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾-Ñ€Ğ°Ğ½Ğ´Ğ¾Ğ¼Ğ¾Ğ¼ (RNG)
  function secureRandomInt(max){
    const array = new Uint32Array(1);
    window.crypto.getRandomValues(array);
    return array[0] % max;
  }

  // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ» Ğ¸Ğ· Ğ±Ğ°Ñ€Ğ°Ğ±Ğ°Ğ½Ğ° Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸
  function getSymbolFromReel(reelIndex, position){
    const reel = reels[reelIndex];
    return reel[position % reel.length];
  }

  // ĞĞ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ±Ğ°Ñ€Ğ°Ğ±Ğ°Ğ½Ğ¾Ğ² Ñ ease-out
  function spinWithAnimation(){
    if(freeSpins > 0){
      freeSpins--;
      message.textContent = `Ğ¤Ñ€Ğ¸ÑĞ¿Ğ¸Ğ½! ĞÑÑ‚Ğ°Ğ»Ğ¾ÑÑŒ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ñ… Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğ¹: ${freeSpins}\n`;
    } else {
      if(balance < betAmount){
        alert("ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ÑÑ€ĞµĞ´ÑÑ‚Ğ² Ğ´Ğ»Ñ ÑĞ¿Ğ¸Ğ½Ğ°!");
        return;
      }
      balance -= betAmount;
      message.textContent = "";
    }
    updateUI();

    soundSpin.currentTime = 0;
    soundSpin.play();

    const slots = document.querySelectorAll('.slot');
    let stopCount = 0;
    let spinDuration = fastSpin ? 600 : 2000;
    let startTime = performance.now();

    // Ğ”Ğ»Ñ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ñ€Ğ°ÑÑˆĞ¸Ñ€ÑÑÑ‰Ğ¸Ñ…ÑÑ Ğ¸ sticky Wild
    let stickyWildPositions = new Set();

    // Ğ—Ğ°Ğ´Ğ°Ñ‘Ğ¼ ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸ Ğ±Ğ°Ñ€Ğ°Ğ±Ğ°Ğ½Ğ¾Ğ² Ñ RNG
    for(let i=0; i<columns; i++){
      reelPositions[i] = secureRandomInt(reels[i].length);
    }

    function animate(){
      let now = performance.now();
      let elapsed = now - startTime;
      let progress = Math.min(elapsed / spinDuration, 1);
      let easeProgress = 1 - Math.pow(1 - progress, 3); // ease out cubic

      for(let col=0; col<columns; col++){
        // Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ±Ğ°Ñ€Ğ°Ğ±Ğ°Ğ½Ğ° Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ easeProgress
        let pos = (reelPositions[col] + reels[col].length - Math.floor(easeProgress * reels[col].length)) % reels[col].length;

        for(let row=0; row<rows; row++){
          const idx = row*columns + col;
          let symbolIndex = (pos + row) % reels[col].length;
          let symbol = reels[col][symbolIndex];

          // Sticky Wild Ğ¾ÑÑ‚Ğ°ÑÑ‚ÑÑ
          if(stickyWildPositions.has(idx)){
            symbol = "ğŸƒ";
          }

          slots[idx].textContent = symbol;
          slots[idx].classList.remove('win');
        }
      }

      if(progress < 1){
        requestAnimationFrame(animate);
      } else {
        // ĞŸĞ¾ÑĞ»Ğµ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ Ğ¸ Ğ±Ğ¾Ğ½ÑƒÑÑ‹
        checkResults(slots, stickyWildPositions);
      }
    }

    animate();
  }

  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² ÑĞ¿Ğ¸Ğ½Ğ°
  function checkResults(slots, stickyWildPositions){
    let totalWin = 0;
    let winMessages = [];

    let giftCount = 0;
    let starCount = 0;
    let scatterCount = 0;

    slots.forEach((s, idx) => {
      if(s.textContent === "ğŸ") giftCount++;
      if(s.textContent === "â­") starCount++;
      if(s.textContent === "ğŸ’") scatterCount++;
    });

    if(giftCount >= 3){
      totalWin += 10 * betAmount;
      winMessages.push(`ğŸ Ğ‘Ğ¾Ğ½ÑƒÑ! +${10 * betAmount} â‚½ (Ğ²Ñ‹Ğ¿Ğ°Ğ»Ğ¾ ${giftCount} Ğ¿Ğ¾Ğ´Ğ°Ñ€ĞºĞ¾Ğ²)`);
      soundBonus.play();
    }
    if(starCount >= 2){
      totalWin += 5 * betAmount;
      winMessages.push(`â­ Ğ‘Ğ¾Ğ½ÑƒÑ! +${5 * betAmount} â‚½ (Ğ²Ñ‹Ğ¿Ğ°Ğ»Ğ¾ ${starCount} Ğ·Ğ²ĞµĞ·Ğ´)`);
      soundBonus.play();
    }
    if(scatterCount >= 3){
      freeSpins += 10;
      winMessages.push(`ğŸ‰ Ğ’Ñ‹Ğ¿Ğ°Ğ»Ğ¾ ${scatterCount} Scatter (ğŸ’)! ĞĞ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¾ 10 Ñ„Ñ€Ğ¸ÑĞ¿Ğ¸Ğ½Ğ¾Ğ²!`);
      soundBonus.play();
    }

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¸Ğ½Ğ¸Ğ¹ Ñ Wild (ğŸƒ)
    winLines.forEach((line, lineIndex) => {
      const lineSymbols = line.map(i => slots[i].textContent);
      let firstSymbol = null;
      for(let sym of lineSymbols){
        if(sym !== "ğŸƒ"){
          firstSymbol = sym;
          break;
        }
      }
      if(!firstSymbol || !payTable[firstSymbol]) return;

      let count = 0;
      for(let sym of lineSymbols){
        if(sym === firstSymbol || sym === "ğŸƒ"){
          count++;
        } else {
          break;
        }
      }

      if(count >= 3 && payTable[firstSymbol][count]){
        let winAmount = payTable[firstSymbol][count] * betAmount;
        totalWin += winAmount;
        winMessages.push(`Ğ›Ğ¸Ğ½Ğ¸Ñ ${lineIndex+1}: ${firstSymbol} x${count} (Ñ Wild) = +${winAmount} â‚½`);
        // ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹ÑˆĞ½Ñ‹Ñ… ÑÑ‡ĞµĞµĞº
        for(let i=0; i<count; i++){
          const idx = line[i];
          slots[idx].classList.add('win');
          // Ğ Ğ°ÑÑˆĞ¸Ñ€ÑÑÑ‰Ğ¸Ğ¹ÑÑ Wild: ĞµÑĞ»Ğ¸ Wild Ğ² Ğ»Ğ¸Ğ½Ğ¸Ğ¸, Ğ´ĞµĞ»Ğ°ĞµĞ¼ sticky
          if(slots[idx].textContent === "ğŸƒ"){
            stickyWildPositions.add(idx);
          }
        }
      }
    });

    if(totalWin > 0){
      lastWin = totalWin;
      balance += totalWin;
      addXP(totalWin);
      message.textContent += winMessages.join('\n') + `\nĞĞ±Ñ‰Ğ¸Ğ¹ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ: ${totalWin} â‚½`;
      soundWin.play();
    } else {
      lastWin = 0;
      message.textContent += "Ğš ÑĞ¾Ğ¶Ğ°Ğ»ĞµĞ½Ğ¸Ñ, Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹Ñˆ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚.";
    }

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ¶ĞµĞºĞ¿Ğ¾Ñ‚ (5% Ğ¾Ñ‚ ÑÑ‚Ğ°Ğ²ĞºĞ¸)
    jackpot += betAmount * 0.05;
    if(Math.random() < 0.001){
      message.textContent += `\nğŸ‰ğŸ‰ğŸ‰ Ğ”Ğ¶ĞµĞºĞ¿Ğ¾Ñ‚ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ğ°Ğ½! +${jackpot.toFixed(2)} â‚½!`;
      balance += jackpot;
      jackpot = 500;
      soundBonus.play();
      // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ²
      const name = prompt("ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼! Ğ’Ñ‹ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ğ°Ğ»Ğ¸ Ğ´Ğ¶ĞµĞºĞ¿Ğ¾Ñ‚! Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ Ğ´Ğ»Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ»Ğ¸Ğ´ĞµÑ€Ğ¾Ğ²:", "Ğ˜Ğ³Ñ€Ğ¾Ğº");
      if(name) addToLeaderboard(name.trim().substring(0,20), jackpot);
    }

    updateUI();

    spinHistory.push({
      time: new Date().toLocaleTimeString(),
      bet: betAmount,
      win: totalWin
    });
    if(spinHistory.length > 100) spinHistory.shift();

    updateUI();
  }

  // Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ²ĞºĞ¾Ğ¹
  betMinus.addEventListener('click', () => {
    if(betAmount > 1) betAmount--;
    updateUI();
  });
  betPlus.addEventListener('click', () => {
    if(betAmount < 20) betAmount++;
    updateUI();
  });

  // ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ
  spinButton.addEventListener('click', () => {
    fastSpin = false;
    spinWithAnimation();
  });

  // Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑĞ¿Ğ¸Ğ½
  fastSpinButton.addEventListener('click', () => {
    fastSpin = true;
    spinWithAnimation();
  });

  // Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼ÑƒĞ·Ñ‹ĞºĞ¾Ğ¹
  let musicPlaying = true;
  toggleMusicButton.addEventListener('click', () => {
    if(musicPlaying){
      bgMusic.pause();
      toggleMusicButton.textContent = "ĞœÑƒĞ·Ñ‹ĞºĞ°: Ğ’Ñ‹ĞºĞ»";
    } else {
      bgMusic.play();
      toggleMusicButton.textContent = "ĞœÑƒĞ·Ñ‹ĞºĞ°: Ğ’ĞºĞ»";
    }
    musicPlaying = !musicPlaying;
  });

  // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
  createSlots();
  loadProgress();
  updateUI();
  bgMusic.volume = 0.2;
  bgMusic.play();

})();
</script>

</body>
</html>
